(()=>{"use strict";var e,t={541:(e,t,n)=>{const r=window.wp.blocks,o=window.wp.i18n,s=window.wp.blockEditor,i=window.wp.components,a=window.wp.element,l=window.wp.apiFetch;var c=n.n(l);const d=window.ReactJSXRuntime,p=e=>{const t=document.createElement("textarea");return t.innerHTML=e,t.value},h=JSON.parse('{"UU":"create-block/pau-table-of-contents-block"}');(0,r.registerBlockType)(h.UU,{edit:function({className:e,attributes:t,setAttributes:n}){const{category:r,postOrder:l,chapterOrder:h}=t,[u,f]=(0,a.useState)([]),[g,x]=(0,a.useState)([]),[b,m]=(0,a.useState)({}),[w,v]=(0,a.useState)(!1),[j,k]=(0,a.useState)({});(0,a.useEffect)(()=>{c()({path:"/wp/v2/categories?parent=0&per_page=100"}).then(e=>f(e)).catch(e=>console.error("Error fetching top-level categories:",e))},[]),(0,a.useEffect)(()=>{if(r&&""!==r){v(!0);const e=parseInt(r,10),t=`/wp/v2/categories?parent=${e}&per_page=100`;c()({path:t}).then(e=>{x(e);const t=e.map(e=>e.id);if(0===h.length||h.some(e=>!t.includes(e))){const e=h.filter(e=>t.includes(e)),r=t.filter(t=>!e.includes(t)),o=[...e,...r];JSON.stringify(h)!==JSON.stringify(o)&&n({chapterOrder:o})}}).catch(t=>{console.error(`Error fetching child categories for parent ${e}:`,t),x([]),v(!1)})}else x([]),m({}),v(!1)},[r]),(0,a.useEffect)(()=>{if(0===g.length)return m({}),void v(!1);v(!0);const e=g.map(e=>c()({path:`/wp/v2/posts?categories=${e.id}&per_page=100&orderby=date&order=asc&_fields=id,title,link&status=publish,future`}).then(t=>({chapterId:e.id,posts:t})));Promise.all(e).then(e=>{const t={};let r={...l},o=!1;e.forEach(({chapterId:e,posts:n})=>{const s=String(e);t[s]=n;const i=n.map(e=>e.id),a=r[s]||[],l=a.filter(e=>i.includes(e)),c=i.filter(e=>!l.includes(e)),d=[...l,...c];JSON.stringify(a)!==JSON.stringify(d)&&(r[s]=d,o=!0)}),m(t),o&&n({postOrder:r}),v(!1)}).catch(e=>{console.error("Error fetching posts for chapters:",e),v(!1),m({})})},[g]);const _=(e,t,r)=>{const o=l[e];if(!o)return;const s=o.indexOf(t);let i=s+("up"===r?-1:1);if(i>=0&&i<o.length){const t=[...o];[t[s],t[i]]=[t[i],t[s]],n({postOrder:{...l,[e]:t}})}},y=(e,t)=>{const r=h.indexOf(e);let o=r+("up"===t?-1:1);if(o>=0&&o<h.length){const e=[...h];[e[r],e[o]]=[e[o],e[r]],n({chapterOrder:e})}},O=(e,t)=>{const n=(b[e]||[]).find(e=>e.id===t);return n?p(n.title.rendered):`[Post ID ${t} - Title Not Found]`},N=(e,t)=>{const n=(b[e]||[]).find(e=>e.id===t);return n?n.link:"#"},S=e=>{const t=parseInt(e,10),n=u.find(e=>e.id===parseInt(r,10));if(n&&n.id===t)return n.name;const o=g.find(e=>e.id===t);return o?p(o.name):`[Category ID ${e} - Name Not Found]`},C=(0,s.useBlockProps)({className:"wp-block-toc-editor p-4 border border-gray-200 rounded-lg bg-gray-50"}),B=h.map(e=>g.find(t=>t.id===e)).filter(Boolean);return(0,d.jsxs)("div",{...C,children:[(0,d.jsx)(s.BlockControls,{children:(0,d.jsx)(i.ToolbarGroup,{children:(0,d.jsx)(s.AlignmentToolbar,{value:t.alignment,onChange:e=>{n({alignment:void 0===e?"none":e})}})})}),(0,d.jsx)(s.InspectorControls,{children:(0,d.jsx)(i.PanelBody,{title:(0,o.__)("Settings","pau-table-of-contents-block"),children:(0,d.jsx)(i.SelectControl,{label:(0,o.__)("Root Category","pau-table-of-contents-block"),value:r,options:[{label:(0,o.__)("Select a root category","pau-table-of-contents-block"),value:""},...u.map(e=>({label:e.name,value:String(e.id)}))],onChange:e=>{n({category:""===e?"":e,postOrder:{},chapterOrder:[]}),k({})},__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})})}),(0,d.jsxs)("div",{className:"toc-preview-container",style:{textAlign:t.alignment},children:[w&&(0,d.jsxs)("div",{className:"flex items-center space-x-2 p-3 bg-indigo-100 text-indigo-800 rounded",children:[(0,d.jsx)(i.Spinner,{}),(0,d.jsx)("p",{children:"Loading chapters and articles..."})]}),!w&&r&&B.length>0&&(0,d.jsx)("div",{className:"wp-block-pau-table-of-contents-block-list",children:(0,d.jsx)("ul",{children:B.map((e,t)=>{const n=String(e.id),r=l[n]||[],s=0===t,a=t===B.length-1,c=j[n]||!1;return(0,d.jsxs)("li",{children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(i.Button,{className:"chapter-toggle-button",onClick:()=>(e=>{k(t=>({...t,[e]:!t[e]}))})(n),isTertiary:!0,"aria-expanded":c,style:{padding:0,margin:0},children:[(0,d.jsx)(i.Dashicon,{icon:c?"arrow-down":"arrow-right",style:{marginRight:8}}),(0,d.jsx)("span",{children:S(e.id)})]}),(0,d.jsxs)("div",{className:"flex space-x-1",children:[(0,d.jsx)(i.Button,{icon:(0,d.jsx)(i.Dashicon,{icon:"arrow-up-alt2"}),label:(0,o.__)("Move Chapter Up","toc-block"),onClick:()=>y(e.id,"up"),disabled:s,isSmall:!0}),(0,d.jsx)(i.Button,{icon:(0,d.jsx)(i.Dashicon,{icon:"arrow-down-alt2"}),label:(0,o.__)("Move Chapter Down","toc-block"),onClick:()=>y(e.id,"down"),disabled:a,isSmall:!0})]})]}),c&&r.length>0&&(0,d.jsx)("ul",{children:r.map((e,t)=>(0,d.jsxs)("li",{children:[(0,d.jsx)("span",{className:"text-gray-600 flex-grow pr-2 text-sm",children:(0,d.jsx)("a",{href:N(n,e),onClick:e=>e.preventDefault(),children:O(n,e)})}),(0,d.jsxs)("div",{className:"flex space-x-1",children:[(0,d.jsx)(i.Button,{icon:(0,d.jsx)(i.Dashicon,{icon:"arrow-up-alt2"}),label:(0,o.__)("Move Article Up","toc-block"),onClick:()=>_(n,e,"up"),disabled:0===t,isSmall:!0}),(0,d.jsx)(i.Button,{icon:(0,d.jsx)(i.Dashicon,{icon:"arrow-down-alt2"}),label:(0,o.__)("Move Article Down","toc-block"),onClick:()=>_(n,e,"down"),disabled:t===r.length-1,isSmall:!0})]})]},e))}),c&&0===r.length&&(0,d.jsx)("p",{className:"text-xs text-gray-500 mt-1 pl-4",children:"(No articles found in this chapter.)"})]},e.id)})})}),!w&&r&&0===B.length&&(0,d.jsx)("p",{className:"p-3 bg-yellow-100 text-yellow-800 rounded",children:"No chapters (child categories) found for this root category."})]})]})},save:function(){return(0,d.jsx)("p",{...s.useBlockProps.save(),children:""})}})}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.m=t,e=[],r.O=(t,n,o,s)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,o,s]=e[d],a=!0,l=0;l<n.length;l++)(!1&s||i>=s)&&Object.keys(r.O).every(e=>r.O[e](n[l]))?n.splice(l--,1):(a=!1,s<i&&(i=s));if(a){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,o,s]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={80:0,72:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,s,[i,a,l]=n,c=0;if(i.some(t=>0!==e[t])){for(o in a)r.o(a,o)&&(r.m[o]=a[o]);if(l)var d=l(r)}for(t&&t(n);c<i.length;c++)s=i[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(d)},n=globalThis.webpackChunkpau_table_of_contents_block=globalThis.webpackChunkpau_table_of_contents_block||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=r.O(void 0,[72],()=>r(541));o=r.O(o)})();